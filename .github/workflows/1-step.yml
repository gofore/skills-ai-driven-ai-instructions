name: Step 1
on:
  push:
    paths:
      - 'AGENTS.md'

jobs:
  check-rules:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate AI Instruction File
        run: |
          # 1. Check if AGENTS.md exists
          if [ ! -f "AGENTS.md" ]; then
            echo "::error::Missing required AI instruction file: AGENTS.md"
            exit 1
          fi

          # 2. Check for "Relevant Chapters" in AGENTS.md
          FILE="AGENTS.md"
          
          REQUIRED_SECTIONS=("Role" "Tech Stack" "Code Style" "Architectural Decisions" "Communication")
          for section in "${REQUIRED_SECTIONS[@]}"; do
            if ! grep -qi "$section" "$FILE"; then
              echo "::error::Missing required section: $section in $FILE"
              exit 1
            fi
          done
          
          echo "Success! Your AI now has a proper constitution."

      - name: Disable current workflow and enable next one
        run: |
          gh workflow disable "${{github.workflow}}"
          gh workflow enable "Step 2"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
